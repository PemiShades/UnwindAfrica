{# templates/dashboard/partials/blog_cards.html #}
<h2 class="text-xl md:text-2xl font-extrabold mb-3">Blog Posts</h2>

<div class="grid sm:grid-cols-2 lg:grid-cols-3 gap-4">
  {% for post in posts %}
    <article class="glass rounded-2xl p-4 shadow-soft border border-white/10 light:border-[#eef0f6] flex flex-col overflow-hidden">
      <div class="relative aspect-[16/9] rounded-xl overflow-hidden ring-1 ring-white/10 light:ring-[#eef0f6]
                  bg-gradient-to-br from-[rgba(142,124,255,.12)] to-[rgba(81,225,167,.10)]">
        {% if post.thumbnail %}
          <img src="{{ post.thumbnail.url }}" alt="{{ post.title }}" class="w-full h-full object-cover">
        {% endif %}
        {% if post.badge %}
          <span class="absolute top-2 left-2 text-[10px] px-2 py-0.5 rounded-full bg-white/85 light:bg-white text-[#0f1320]">
            {{ post.badge }}
          </span>
        {% endif %}
      </div>

      <h3 class="mt-3 text-lg font-bold leading-tight">{{ post.title }}</h3>
      <p class="text-xs opacity-70 mt-1">
        {{ post.category }} • {{ post.created_at|date:"d M, Y" }}
        • <span class="uppercase tracking-wide">{{ post.is_published|yesno:"Published,Draft" }}</span>
        {% if post.read_minutes %} • {{ post.read_minutes }} min read{% endif %}
      </p>

      {% if post.excerpt %}
        <p class="mt-2 text-sm opacity-80 overflow-hidden" style="display:-webkit-box;-webkit-line-clamp:3;-webkit-box-orient:vertical;">
          {{ post.excerpt }}
        </p>
      {% endif %}

      {# ACTION ROW — single line, no wrap; scrolls horizontally if ever too tight #}
      <div class="mt-3 mt-auto flex items-center gap-2 overflow-x-auto flex-nowrap [-ms-overflow-style:none] [scrollbar-width:none]"
           style="-webkit-overflow-scrolling:touch;">
        <button
          class="btn-primary shrink-0 whitespace-nowrap"
          @click.stop
          onclick="window.__editPost &&
                   window.__editPost(
                     '{{ post.slug|default_if_none:'' }}',
                     '{{ post.title|escapejs }}',
                     '{{ post.content|default_if_none:''|escapejs }}',
                     '{{ post.category|default_if_none:''|escapejs }}',
                     '{{ post.is_published|yesno:"true,false" }}',
                     '{{ post.is_featured|yesno:"true,false" }}'
                   )">
          <i class="fa-solid fa-pen mr-2"></i>Edit
        </button>

        {% if post.slug %}
          <form action="{% url 'blog_delete' post.slug %}" method="post" class="inline shrink-0" @click.stop>
            {% csrf_token %}
            <button type="submit" class="btn-ghost shrink-0 whitespace-nowrap border border-red-500/30 hover:border-red-500/60 text-red-400 light:text-red-600">
              <i class="fa-solid fa-trash-can mr-2"></i>Delete
            </button>
          </form>

          {# Use your named route if available: {% url 'blog_detail' slug=post.slug %} #}
          <a href="{{ post.get_absolute_url|default:'/blog/'|add:post.slug }}"
             class="btn-ghost shrink-0 whitespace-nowrap ml-auto border border-emerald-400/30 hover:border-emerald-400/60"
             @click.stop>
            <i class="fa-regular fa-eye mr-2"></i>View
          </a>
        {% else %}
          <button type="button" class="btn-ghost shrink-0 opacity-60 cursor-not-allowed" title="Add a title to generate a slug">
            <i class="fa-solid fa-trash-can mr-2"></i>Delete
          </button>
          <span class="ml-auto text-xs opacity-70 whitespace-nowrap">No slug yet</span>
        {% endif %}
      </div>
    </article>
  {% empty %}
    <p class="opacity-70">No posts yet.</p>
  {% endfor %}
</div>
